
{% extends "cadmin/base_admin.html" %}

{% block title %}
{% endblock %}

{% block main %}
 <head><style>

   .scrollable-menu {
      height: auto;
      max-height: 200px;
      overflow-x: hidden;
    }
  </style>
</head>

{%load static%}

{% load subtractify %}
   <div class="page-wrapper">
        
        {% include "cadmin/header.html" %}
        <!-- start page container -->
        <div class="page-container">
             {% include "cadmin/sidebar.html" %}
            <!-- start page content -->
             <div class="page-content-wrapper">
                <div class="page-content">
                    <div class="page-bar">
                        <div class="page-title-breadcrumb">
                            <div class=" pull-left">
                                <div class="page-title">Purchase View</div>
                            </div>
                            <ol class="breadcrumb page-breadcrumb pull-right">
                                <li><i class="fa fa-home"></i>&nbsp;<a class="parent-item" href="{% url 'index' %}">Home</a>&nbsp;<i class="fa fa-angle-right"></i>
                                </li>
                                 <li><a class="parent-item" href="{% url 'purchase_list' %}">Purchase</a>&nbsp;<i class="fa fa-angle-right"></i>
                                </li>
                                <li class="active">Purchase View</li>
                            </ol>
                        </div>
                    </div>
                     
                   <!-- start widget -->
                    <div class="row">
                       
                             <!-- BEGIN PROFILE SIDEBAR -->
                            <div class="col-lg-3 col-md-6 col-sm-12 col-12">
                                <div class="card">
                                    <div class="panel-body">
                                        <h3>Total Purchase</h3>
                                        <div class="progressbar-xs progress-rounded progress-striped progress ng-isolate-scope active">
                                            <div class="progress-bar progress-bar-green width-60" role="progressbar" aria-valuenow="65" aria-valuemin="0" aria-valuemax="100"></div>
                                        </div>
                                        <span class="text-small margin-top-10 full-width"><div class="uppercase profile-stat-title"> {{ purchases.paginator.count }} </div></span> </div>
                                </div>
                            </div>
                            <div class="col-lg-3 col-md-6 col-sm-12 col-12">
                                <div class="card">
                                    <div class="panel-body">
                                        <h3>Total Purchase Present In Stock</h3>
                                        <div class="progressbar-xs progress-rounded progress-striped progress ng-isolate-scope active">
                                            <div class="progress-bar progress-bar-orange width-75" role="progressbar" aria-valuenow="68" aria-valuemin="0" aria-valuemax="100"></div>
                                        </div>
                                        <span class="text-small margin-top-10 full-width"><div class="uppercase profile-stat-title"> {{total_quantity}} </div></span> </div>
                                </div>
                            </div>
                            <div class="col-lg-3 col-md-6 col-sm-12 col-12">
                                <div class="card">
                                    <div class="panel-body">
                                        <h3>Stock Amount Paid</h3>
                                        <div class="progressbar-xs progress-rounded progress-striped progress ng-isolate-scope active" >
                                            <div class="progress-bar progress-bar-purple width-40" role="progressbar" aria-valuenow="52" aria-valuemin="0" aria-valuemax="100"></div>
                                        </div>
                                        <span class="text-small margin-top-10 full-width"><div class="uppercase profile-stat-title"> {{stock_amount}} </div></span> </div>
                                </div>
                            </div>
                                <!-- END PROFILE CONTENT -->
                            
                        </div>
                                <!-- END TABS CONTENT -->

                         <div class="row">
                       
                        <div class="col-md-12 col-sm-12">
                            <div class="borderBox light bordered card-box">
                                <div class="borderBox-title tabbable-line">
                                    <div class="caption">
                                        <span class="caption-subject font-dark bold uppercase">Purchase History</span>
                                    </div>
                                    <ul class="nav nav-tabs">
                                        <li class="nav-item dropdown">
                                            <a href="javascript:;" class="dropdown-toggle" data-toggle="dropdown"> By Year
                                                <i class="fa fa-angle-down"></i>
                                            </a>
                                                <ul class="dropdown-menu scrollable-menu" role="menu">
                                                 <li class="nav-item">
                                                     <a href="#tab_6_1" tabindex="-1" data-toggle="tab">2018 </a>
                                                 </li>
                                                <li class="nav-item">
                                                     <a href="#tab_6_2" tabindex="-1" data-toggle="tab"> 2017</a>
                                                </li>
                                                <li class="nav-item">
                                                    <a href="#tab_6_3" tabindex="-1" data-toggle="tab"> 2016</a>
                                                 </li>
                                                 <li class="nav-item">
                                                    <a href="#tab_6_4" tabindex="-1" data-toggle="tab">2015</a>
                                                 </li>
                                                 <li class="nav-item">
                                                    <a href="#tab_6_5" tabindex="-1" data-toggle="tab">2014</a>
                                                 </li>
                                                 <li class="nav-item">
                                                    <a href="#tab_6_6" tabindex="-1" data-toggle="tab">2013</a>
                                                 </li>
                                                 <li class="nav-item">
                                                     <a href="#tab_6_7" tabindex="-1" data-toggle="tab">2012 </a>
                                                 </li>
                                                <li class="nav-item">
                                                     <a href="#tab_6_8" tabindex="-1" data-toggle="tab"> 2011</a>
                                                </li>
                                                <li class="nav-item">
                                                    <a href="#tab_6_9" tabindex="-1" data-toggle="tab"> 2010</a>
                                                 </li>
                                                 
                                                </ul>
                                        </li>
                                        <li class="nav-item dropdown">
                                            <a href="javascript:;" class="dropdown-toggle" data-toggle="dropdown"> By Month
                                                <i class="fa fa-angle-down"></i>
                                            </a>
                                                <ul class="dropdown-menu scrollable-menu" role="menu">
                                                 <li class="nav-item">
                                                     <a href="#tab_7_1" tabindex="-1" data-toggle="tab">Jan </a>
                                                 </li>
                                                <li class="nav-item">
                                                     <a href="#tab_7_2" tabindex="-1" data-toggle="tab"> Feb</a>
                                                </li>
                                                <li class="nav-item">
                                                    <a href="#tab_7_3" tabindex="-1" data-toggle="tab"> Mar </a>
                                                 </li>
                                                 <li class="nav-item">
                                                    <a href="#tab_7_4" tabindex="-1" data-toggle="tab">Apr</a>
                                                 </li>
                                                 <li class="nav-item">
                                                    <a href="#tab_7_5" tabindex="-1" data-toggle="tab">May</a>
                                                 </li>
                                                 <li class="nav-item">
                                                    <a href="#tab_7_6" tabindex="-1" data-toggle="tab">Jun</a>
                                                 </li>
                                                  <li class="nav-item">
                                                     <a href="#tab_7_7" tabindex="-1" data-toggle="tab">Jul </a>
                                                 </li>
                                                <li class="nav-item">
                                                     <a href="#tab_7_8" tabindex="-1" data-toggle="tab"> Aug</a>
                                                </li>
                                                <li class="nav-item">
                                                    <a href="#tab_7_9" tabindex="-1" data-toggle="tab"> Sep </a>
                                                 </li>
                                                 <li class="nav-item">
                                                    <a href="#tab_7_10" tabindex="-1" data-toggle="tab">Oct</a>
                                                 </li>
                                                 <li class="nav-item">
                                                    <a href="#tab_7_11" tabindex="-1" data-toggle="tab">Nov</a>
                                                 </li>
                                                 <li class="nav-item">
                                                    <a href="#tab_7_12" tabindex="-1" data-toggle="tab">Dec</a>
                                                 </li>
                                                </ul>
                                        </li>
                                        <li class="nav-item">
                                            <a href="#borderBox_tab2" data-toggle="tab"> By Week </a>
                                        </li>
                                        <li class="nav-item">
                                            <a href="#borderBox_tab1" data-toggle="tab" class="active"> All </a>
                                        </li>

                                    </ul>
                                </div>
                                <div class="borderBox-body">
                                    <div class="tab-content">
                                        <div class="tab-pane active" id="borderBox_tab1">
                                <div class="card-body ">
                                  <div class="table-wrap">
                                        <div class="table-responsive">
        
                                        {% for purchase in purchases %}
                                            {% if forloop.first     %}
                                               <table   class="table display product-overview mb-30" id="support_table5">
                                                <thead>
                                                    <tr>
                                                        <th>Id</th>
                                                        <th>Supplier</th>
                                                        <th>Product</th>
                                                        <th>Total Bill</th>
                                                        <th>Discount</th>
                                                        <th>Amount Paid</th>
                                                        <th>Balance</th>
                                                        <th>Date</th>
                                                 
                                                    </tr>
                                                </thead>
                                            {% endif %}
                
                <tr>
                    <td title="{{ purchase.id }}">{{ purchase.id}}</td>
                    <!-- <td class="purchase-name" title="{{ purchase.name }}">{{ purchase.name|truncatechars:50 }}</td> -->
                    <!-- <td>{{ supplier.category }}</td> -->
                    <td title="{{ purchase.supplier }}">{{ purchase.supplier}}</td>
                    <td title="{{ purchase.product }}"> {{ purchase.product }}</td>
                    <!-- {% if request.user.is_superuser %}
                        <td>{{ purchase.author }}</td>
                    {% endif %} -->
                  
                    {% for product in products %} 
                    {% if purchase.product.id == product.id %}                  
                    <td title="{{purchase.totalbill}}">{{ product.bill }} </td>  
                    {% endif %}                 
                    {% endfor %}

                    <td title="{{ purchase.discount }}">{{ purchase.discount }}</td>

                    {% for supplier_ledger in supplier_ledgers %}
                    {% for product in products %} 
                    {% if purchase.supplier.id == supplier_ledger.supplier.id %}
                    {% if purchase.product.id == product.id %}    
                    <td title="{{ purchase.paidAmount }}">{{ supplier_ledger.amount_paid }}</td>
                    <td title="{{ purchase.balance }}">{{product.bill|subtract:purchase.discount|add:supplier_ledger.amount_paid}}</td>
                    {% endif %}  
                    {% endif %}                
                    {% endfor %}
                    {% endfor %}

                    <td title="{{ purchase.created_at }}">{{ purchase.created_at|date:"d M Y" }}</td>
                   
                </tr>

                {% if forloop.last %}
                    </table>
                {% endif %}

            {% empty %}
                No Purchasess
            {% endfor %}

    </div>

    {% if purchases %}

        <div class="pagination">
            <p>
                {% if purchases.has_previous %}
                    <a href="?page={{ purchases.previous_page_number }}{% if request.GET.q %}&q={{request.GET.q}}{% endif %}">&lt; Prev</a> |
                {% endif %}

                {% if purchases.has_next %}
                    <a href="?page={{ purchases.next_page_number }}{% if request.GET.q %}&q={{request.GET.q}}{% endif %}">Next &gt;</a>
                {% endif %}

                <span>Page {{ purchases.number }} of {{ purchases.paginator.num_pages }}</span>
            </p>
        </div>

    {% endif %}
{% if messages %}
            {% for message in messages %}
            <p>{{ message }}</p>
            {% endfor %}
        {% endif %}

                                        </div>  
                                     <div class="clearfix"></div>
                                        <hr>
                                        <div class="text-right">
                                            
                                            <button onclick="javascript:window.print();" class="btn btn-default btn-outline" type="button"> <span><i class="fa fa-print"></i> Print</span> </button>
                                        </div>
                                    </div>
                                </div>

                                        
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                <!-- end page content -->
            
        </div>
        <!-- end page container -->
        </div>
          </div>
{% endblock %}
